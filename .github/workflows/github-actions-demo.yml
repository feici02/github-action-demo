name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      # in this step, prepare the message and save it to PR_INFO so that it can be sent to Feishu
      - name: Prepare message
        id: prepare
        run: |
          PR_INFO=$(cat <<EOF
ðŸš€ ${{ github.actor }} is testing out GitHub Actions ðŸš€
PR Title: ${{ github.event.pull_request.title }}
PR Owner: ${{ github.event.pull_request.user.login }}
Additional line 1
Additional line 2
EOF
)
          echo "::set-output name=PR_INFO::$PR_INFO"

      - name: Test
        run: |
          curl -X POST -H "Content-Type: application/json" \
          post_to_feishu() {
            local text="$1"
            curl -X POST -H "Content-Type: application/json" \
            -d @- https://open.feishu.cn/open-apis/bot/v2/hook/ead5417f-20b9-425c-8ce7-f4b8dd008deb <<EOF
            {
              "msg_type": "text",
              "content": {
                "text": "$text"
              }
            }
            EOF
          }

          post_to_feishu "$PR_INFO"
